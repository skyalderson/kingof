{% extends 'base.html.twig' %}

{% block title %}{{ game.name }}{% endblock %}

{% block body %}

<!--p>TODO : </p>
<ul>
    <li> SELECTION ALEATOIRE !!! </li>
    <li>actualiser liste joueurs :</li> 
    <li>
        <ul>
            <li>bouton kick seulement si app.user = creator</li>
            <li>occurence joueur</li>
        </ul>
    </li>
    <li>bouton quitter la partie</li>
    <li>lancer la partie (vérif tout le monde a un monstre / tout le monde est prêt)</li>
    <li>largeur label joueur</li>
    <li>largeur colonnes selon résolution</li>
    <li>vérifier si la partie est lancée</li>
    
</ul-->


<!-- Modal -->
<div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="nope" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
      <div id="modal_msg" class="modal-body goodgirl">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div  class="jumbotron goodgirl mr-3 ml-3 mb-0 pt-3 pb-3 mt-2">
    <div class="row justify-content-center text-center mb-4">
        <h3 class="col-xl-8 col-lg-8 col-md-8 bg-purple lbl text-yellow text-center pt-2 pb-2">{{ game.name }}
            {% if app.user == game.creatoruser %}<a class="btn btn-danger btn-sm mr-2 mt-0" href={{ path('game.delete', { 'id': game.id }) }} style="position: absolute; display: inline; right: 0;"><img src="/img/trash.png" height="24px"></a>{% endif %}
        </h3></div>
    <form  name="lobby" method="post">
    <div id="list">
    {% for player in game.players %}
        <div id="row_{{ player.id }}" class="row justify-content-center row_player" data-playerid="{{ player.id }}">
            <div class="col-auto mt-2 mb-2 pl-0"><span class="align-middle bg-purple lbl text-yellow text-center col-form-label p-2">Joueur {{ loop.index }}:</span></div>
            
            <div class="col-xl-1 col-lg-1 col-md-1 mt-2 mb-2 text-center"><span>{{ player.user.username }}</span></div>
                         
            <div class="col-auto">
                    <label class="col-form-label  required" for="lobby_monster"><span class="align-middle bg-purple lbl text-yellow text-center p-2">Monstre :</span></label>
                </div>
            {% if app.user == player.user %}            
                
                <div class="col-xl-3 col-lg-3 col-md-3">
                    
                    <select id="lobby_monster_self" name="lobby[monster]" required="required" class="form-control custom-select">
                        <option value="0" selected="selected">Choisissez votre monstre</option>
                        {% for monster in form.monster.vars.choices %}
                            <option value="{{ monster.value }}" {% if player.monster != null and player.monster.id == monster.value %}selected{% endif %}>{{ monster.label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-xl-1 col-lg-1 col-md-1 pl-0 text-center">
                    <input type="checkbox" id="lobby_ready_self" name="lobby[ready][{{ player.id}}]" data-width="128" data-toggle="toggle" data-on="Prêt !" data-off="Prêt ?" data-onstyle="success" data-offstyle="danger" {% if player.isready == false %}{% else %}checked{% endif %}/>
                </div>  
                <div>
                </div>         
                <div id="data" data-gameid="{{ game.id }}" data-playerid="{{ player.id }}" display="none"></div>       
            {% else %}
                <div class="col-xl-3 col-lg-3 col-md-3">                   
                    <input type="text" id="monster_{{ player.id}}" name="monster_{{ player.id}}" readonly='readonly' disabled='disabled' value="{% if player.monster == null %}Aucun monstre sélectionné{% else %}{{ player.monster.name}}{% endif %}" class="form-control">
                </div>
                <div class="col-xl-1 col-lg-1 col-md-1 pl-0 text-center">
                    <span id='ready_{{ player.id}}' style="font-size:1.5rem;">
                        {% if player.isready == false %}
                            <span class="badge badge-danger mt-1">Attente</span>
                        {% else %}
                            <span class="badge badge-success mt-1">Prêt</span>
                        {% endif %}          
                    </span>
                </div>                    
            {% endif %}

            <div class="col-xl-1 col-lg-1 col-md-1 text-right mr-0 pr-0">
                {% if app.user == game.creatoruser and player.user != app.user %}
                    <a class="btn btn-danger btn-sm mt-1" href={{ path('player.kick', { 'id' : player.id }) }}>Kick</a> 
                {% else  %}  
                {% if player.user == app.user and app.user != game.creatoruser%}
                    <a class="btn btn-danger btn-sm mt-1" href={{ path('player.kick', { 'id' : player.id }) }}><img src="/img/quit.png" height="24px"></a> 
                {% endif %} 
                {% endif %}   
            </div>    
        </div>
    {% endfor %}  
    </div>
    <input type="hidden" id="lobby__token" name="lobby[_token]" value="JuZQAMAkRNqHF3FfDrtd_g-MTHekRGWBEUxAm61X7fI" />
    {% if app.user == game.creatoruser %}
        <div class="row justify-content-center mt-2">
            <input type='submit' class="btn btn-danger mb-2 col-12 col-xl-4 col-lg-4 col-md-4" id='launchgame' name='launchgame' value='Lancer la partie !' disabled='disabled'></div>
        
    {% endif %}
    </form> 
    </div> 
    
{% endblock %}


{% block javascripts %}
    {{ encore_entry_script_tags('lobby') }} 
{% endblock %}

